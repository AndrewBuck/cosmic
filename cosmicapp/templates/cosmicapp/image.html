{% extends "cosmicapp/base.html" %}
{% load static %}
{% load cosmicapp_extras %}

{% block extratitle %} - Image {{id}} {% endblock %}

{% block extrahead %}
<style>
td.numSourceResults
{
    background-color: #69F;
    text-align: center;
}

td.numMatchResults
{
    background-color: #EE4;
    text-align: center;
}
</style>
{% endblock extrahead %}

{% block mainbody %}
<h2>Image {{id}}</h2>

    <table border=2px style="border-collapse: collapse; margin: 1em;">
        <tr>
        <th> Uploaded By <br> (username) </th>
        <th> Instrument <br> (telescope) </th>
        <th> X Dim <br> (pixels) </th>
        <th> Y Dim <br> (pixels) </th>
        <th> Z Dim <br> (layers) </th>
        <th> Bit Depth <br> (bits / px) </th>
        <th> Frame Type <br> (light/flat/etc) </th>
        </tr>

        <tr>
        <td> <a href="/user/{{image.fileRecord.uploadingUser}}">{{image.fileRecord.uploadingUser}}</a> </td>
        <td> {{image.instrument}} </td>
        <td> {{image.dimX}} </td>
        <td> {{image.dimY}} </td>
        <td> {{image.dimZ}} </td>
        <td> {{image.bitDepth}} </td>
        <td> {{image.frameType}} </td>
        </tr>
    </table>

<table border=2px style="border-collapse: collapse; margin: 1em;">
<tr>
<th>Channel</th>
<th>Type</th>
<th>Mean</th>
<th>Medain</th>
<th>StdDev</th>
<th>Background<br>Mean</th>
<th>Background<br>Median</th>
<th>Background<br>StdDev</th>
</tr>
{% for channel in image.imagechannelinfo_set.all %}
<tr>
<td>{{channel.index}}</td>
<td>{{channel.channelType}}</td>
<td>{{channel.mean|floatformat:3}}</td>
<td>{{channel.median|floatformat:3}}</td>
<td>{{channel.stdDev|floatformat:3}}</td>
<td>{{channel.bgMean|floatformat:3}}</td>
<td>{{channel.bgMedian|floatformat:3}}</td>
<td>{{channel.bgStdDev|floatformat:3}}</td>
</tr>
{% endfor %}
</table>

<p>This image has {{image.plateSolutions.count}} plate solutions assosciated with it.</p>

{% if image.plateSolutions.count > 0 %}
    <table border=2px style="border-collapse: collapse; margin: 1em;">
        <th>Source</th>
        <th>Center RA</th>
        <th>Center Dec</th>
        <th>Rotation</th>
        <th>Resolution X</th>
        <th>Resolution Y</th>

    {% for ps in image.plateSolutions.all %}
        <tr>
        <td>{{ps.source}}</td>
        <td>{{ps.centerRA|formatRA}}</td>
        <td>{{ps.centerDec|formatDec}}</td>
        <td>{{ps.rotation|floatformat:2}}</td>
        <td>{{ps.resolutionX|floatformat:2}}</td>
        <td>{{ps.resolutionY|floatformat:2}}</td>
        </tr>
    {% endfor %}

    </table>
{% endif %}

<br>
    <table border=2px style="border-collapse: collapse; margin: 1em;">
        <tr>
        <th rowspan=2 colspan=2> <a href="/image/{{id}}/sources/">View sources</a></p> </th>
        <th>Sextractor</th>
        <th>Image2xy</th>
        <th>Daofind</th>
        <th>Starfind</th>
        </tr>

        <tr>
        <td class=numSourceResults>{{numSextractorSources}}</td>
        <td class=numSourceResults>{{numImage2xySources}}</td>
        <td class=numSourceResults>{{numDaofindSources}}</td>
        <td class=numSourceResults>{{numStarfindSources}}</td>
        </tr>

        <tr>
        <th>Sextractor</th>
        <td class=numSourceResults>{{numSextractorSources}}</td>
        <td class=numMatchResults></td>
        <td class=numMatchResults>{{numSextractorImage2xyMatches}}</td>
        <td class=numMatchResults>{{numSextractorDaofindMatches}}</td>
        <td class=numMatchResults>{{numSextractorStarfindMatches}}</td>
        </tr>

        <tr>
        <th>Image2xy</th>
        <td class=numSourceResults>{{numImage2xySources}}</td>
        <td class=numMatchResults>{{numSextractorImage2xyMatches}}</td>
        <td class=numMatchResults></td>
        <td class=numMatchResults>{{numImage2xyDaofindMatches}}</td>
        <td class=numMatchResults>{{numImage2xyStarfindMatches}}</td>
        </tr>

        <tr>
        <th>Daofind</th>
        <td class=numSourceResults>{{numDaofindSources}}</td>
        <td class=numMatchResults>{{numSextractorDaofindMatches}}</td>
        <td class=numMatchResults>{{numImage2xyDaofindMatches}}</td>
        <td class=numMatchResults></td>
        <td class=numMatchResults>{{numDaofindStarfindMatches}}</td>
        </tr>

        <tr>
        <th>Starfind</th>
        <td class=numSourceResults>{{numStarfindSources}}</td>
        <td class=numMatchResults>{{numSextractorStarfindMatches}}</td>
        <td class=numMatchResults>{{numImage2xyStarfindMatches}}</td>
        <td class=numMatchResults>{{numDaofindStarfindMatches}}</td>
        <td class=numMatchResults></td>
        </tr>
    </table>

<p>This image has {{numProperties}} property tags assosciatied with it.  <a href="/image/{{id}}/properties/">View properties</a></p>

<p>Answer questions about this image.  <a href="/image/{{id}}/question/">Answer questions</a></p>

<p>Original uploaded filename: <b>{{image.fileRecord.originalFileName}}</b></p>
<p>SHA 256 hash of original file: <b>{{image.fileRecord.fileSha256}}</b></p>

<h3>Processing<h3>
<!-- TODO: Add processing queue jobs for this image. -->

<h3>Image thumbnail</h3>

<p>
{{image.getThumbnailSmall|safe}}
{{image.getThumbnailMedium|safe}}
{{image.getThumbnailLarge|safe}}
</p>

<p>
{{image.getThumbnailFull|safe}}
</p>

{% endblock %}

