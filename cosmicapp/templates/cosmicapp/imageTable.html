<script>
var numRows = {{numRows}}, numCols = {{numCols}};
var includeLinks = {{includeLinks}};
var thumbnailSize = "{{thumbnailSize}}"

var resultsPage = 0;
var loadingInProgress = false;

function loadImageGalleryResults()
{
    if(!loadingInProgress)
    {
        loadingInProgress = true;
        gallery = document.getElementById("imageGalleryDiv");
        currentHTML = gallery.innerHTML;
        loadingHTML = currentHTML + "<p>Loading...</p>";
        gallery.innerHTML = loadingHTML;

        request = new XMLHttpRequest();

        request.onreadystatechange = function()
        {
            if(this.readyState == 4 && this.status == 200)
            {
                xml = this.responseXML;
                html = ""

                results = xml.getElementsByTagName('Image')
                for(i = 0; i < results.length; i++)
                {
                    attr = results[i].attributes;

					html += '<div class="responsive">'
					html += '<div class="gallery">'
                    if(includeLinks)
                        html += '<a href="/image/' + attr.getNamedItem('id').nodeValue + '/">'
                    html += '<img src="' + attr.getNamedItem('thumbUrl'+thumbnailSize).nodeValue + '" width="300">';
					if(includeLinks)
						html += '</a>';
					html += '<div class="desc">' + attr.getNamedItem('id').nodeValue + '</div>'
					html += '</div>'
					html += '</div>'
                }

                gallery.innerHTML = currentHTML + html;
                loadingInProgress = false;
            }
        };

        requestURL = "/query/?queryfor=image&{{queryKey}}={{queryValue}}&order=time_desc&limit=" + numRows*numCols + "&offset=" + numRows*numCols*resultsPage;
        request.open("GET", requestURL, true);
        request.send()

        resultsPage++;
    }
};

window.onload = loadImageGalleryResults;

</script>

<div id=imageGalleryDiv></div>

<div class="responsive">
	<div style="text-align:center;">
		<input type=button class=button value="Load more" onclick="loadImageGalleryResults()">
	</div>
</div>

<div class="clearfix"></div>

