<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">
</script>

<script>
var numRows = {{numRows}}, numCols = {{numCols}};
var includeLinks = {{includeLinks}};
var thumbnailSize = "{{thumbnailSize}}"

var resultsPage = 0;
var loadingInProgress = false;

function loadImageGalleryResults()
{
    if(!loadingInProgress)
    {
        loadingInProgress = true;

        gallery = document.getElementById("imageGalleryDiv");
        currentHTML = gallery.innerHTML;
        $('#imageGalleryDiv').append('<div id="imageGalleryLoadingMessage"><p>Loading...</p><div>');

        $.get("/query/?queryfor=image&{{queryKey}}={{queryValue}}&order=time_desc&limit=" + numRows*numCols +
                    "&offset=" + numRows*numCols*resultsPage, function(xml, statusCode) {

            html = ""

            results = xml.getElementsByTagName('Image')
            for(i = 0; i < results.length; i++)
            {
                attr = results[i].attributes;

                html += '<div class="responsive">'
                html += '<div class="gallery">'
                if(includeLinks)
                    html += '<a href="/image/' + attr.getNamedItem('id').nodeValue + '/">'
                html += '<img src="' + attr.getNamedItem('thumbUrl'+thumbnailSize).nodeValue + '" width="300">';
                if(includeLinks)
                    html += '</a>';
                html += '<div class="desc">' + attr.getNamedItem('id').nodeValue + '</div>'
                html += '</div>'
                html += '</div>'
            }

            $('#imageGalleryLoadingMessage').remove();
            $('#imageGalleryDiv').append(html);

            loadingInProgress = false;

            return "blah";
        });

        resultsPage++;
    }
};

$(document).ready(loadImageGalleryResults);

</script>

<div id=imageGalleryDiv></div>

<div class="responsive">
	<div style="text-align:center;">
		<input type=button class=button value="Load more" onclick="loadImageGalleryResults()">
	</div>
</div>

<div class="clearfix"></div>

